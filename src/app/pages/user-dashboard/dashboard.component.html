<div class="dashboard">
  <div class="header">
    <h2>User Dashboard</h2>

    @if (users.length) {
      <app-search (searchChange)="onSearchChange($event)"></app-search>

      <!-- ROLE FILTER -->
      <p-dropdown
        [options]="roleOptions"
        optionLabel="label"
        optionValue="value"
        placeholder="Filter by role"
        class="role-filter"
        (onChange)="onRoleFilter($event.value)"
        showClear
      ></p-dropdown>
    }

    <button
      pButton
      label="Add User"
      icon="pi pi-plus"
      class="add-btn"
      (click)="onAddUser('add')"
    ></button>
  </div>

  <p-table
    #dt
    [value]="users"
    [paginator]="true"
    [rows]="5"
    responsiveLayout="scroll"
    [globalFilterFields]="['name', 'email', 'role']"
    [loading]="tableLoading"
  >
    <ng-template pTemplate="loadingbody">
      <tr *ngFor="let _ of [1, 2, 3, 4, 5]">
        <td>
          <p-skeleton height="1.2rem" width="80%"></p-skeleton>
        </td>
        <td>
          <p-skeleton height="1.2rem" width="90%"></p-skeleton>
        </td>
        <td>
          <p-skeleton height="1.2rem" width="60%"></p-skeleton>
        </td>
      </tr>
    </ng-template>

    <ng-template pTemplate="header">
      <tr>
        <th>User Id</th>
        <th>Name</th>
        <th>Email</th>
        <th>Role</th>
        <th>Action</th>
      </tr>
    </ng-template>

    <ng-template pTemplate="body" let-user>
      <tr>
        <td>{{ user._id }}</td>
        <td>{{ user.name }}</td>
        <td>{{ user.email }}</td>
        <td>{{ user.role }}</td>
        <td>
          <button
            pButton
            label="Edit"
            icon="pi pi-pencil"
            class="p-button-sm"
              style="margin-right: 8px"
            (click)="onAddUser('edit', user)"
          ></button>
          <button
            pButton
            label="Delete"
            icon="pi pi-trash"
            (click)="onDeleteUser(user._id)"
            class="p-button-sm p-button-danger"
          ></button>
        </td>
      </tr>
    </ng-template>

    <ng-template pTemplate="emptymessage">
      <tr>
        <td colspan="3" class="empty">No data found !!!</td>
      </tr>
    </ng-template>
  </p-table>

  <div class="chart-container">
    <canvas #roleChart></canvas>
  </div>
</div>
